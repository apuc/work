# Аутентификация #

---
## Реализация ##
Для учёта аутентифицированных пользователей используется таблица `user_device_token`.<br>
Аутентификация происходит на каждом устройстве отдельно, для доступа по апи выдаётся `access_token`, который имеет время истечения `access_token_expiration_time`.<br>
Когда срок действия токена истёк, необходимо получить новый токен доступа с помощью токена обновления `refresh_token`.<br>
Токен обновления так же имеет время истечения `refresh_token_expiration_time`, в таком случае необходима повторная аутентификация.

## Таблица ##
**user_device_token**
<table>
    <tr>
        <th>Колона</th>
        <th>Тип данных</th>
        <th>Описание</th>
        <th>Индекс</th>
    </tr>
    <tr>
        <td>user_id</td>
        <td>integer(11)</td>
        <td>ID пользователя</td>
    </tr>
    <tr>
        <td>device_id</td>
        <td>string(256)</td>
        <td>Стоковое id устройства</td>
    </tr>
    <tr>
        <td>access_token</td>
        <td>string(512)</td>
        <td>Токен доступа</td>
        <td></td>
    </tr>
    <tr>
        <td>access_token_expiration_time</td>
        <td>timestamp</td>
        <td>Дата и время истечения токена доступа</td>
    </tr>
    <tr>
        <td>refresh_token</td>
        <td>string(512)</td>
        <td>Токен обновления</td>
    </tr>
    <tr>
        <td>refresh_token_expiration_time</td>
        <td>timestamp</td>
        <td>Дата и время истечения токена обновления</td>
        <td></td>
    </tr>
</table>

## Сценарий взаимодействия по API ##
[//]: # (todo оставить ссылку на API, мб указать роут)
- логин/пароль отправляются на роут аутентификации 
- при успешном логине бэк отдаёт токены доступа и обновления и их время истечения, чтобы клиент тоже знал когда их обновлять 
  + при неудаче, возвращается соотвествующий статус и сообщение 
- при обращении к роутам, требующим аутентификацию, клиент отправляет `access_token`
- при недействительности токена доступа, возвращается соотв. статус и сообщение о необходимости обновить токен доступа
- для обновления токена доступа клиент шлёт запрос с `refresh_token`
  + при неудаче - соотв. статус, сообщение -> необходимо аутентифицироваться заново
  + при успехе клиент получает новый `access_token` и его время истечения

---

Рекоммендуемое время действия токена обновления - 30+ дней, токена доступа - от 1 до 24 часов.